# ==========================================
# 基本設定
# ==========================================

# プレフィックスキーを Ctrl-b から Ctrl-g に変更
# (片手で押しやすく、他のショートカットと被りにくい)
set -g prefix C-t
unbind C-b
bind C-t send-prefix

# マウス操作を有効にする
set -g mouse on

# エスケープキーの入力待ち時間をなくす
set -s escape-time 0

# インデックスを1から始める（0はキーボードの右端で押しにくいため）
set -g base-index 1
setw -g pane-base-index 1

# 設定ファイルをリロードするショートカット (Prefix + r)
bind r source-file ~/.tmux.conf \; display "Reloaded!"

# 256色モードを有効にする
set -g default-terminal "screen-256color"
set -ag terminal-overrides ",xterm-256color:RGB"

# ==========================================
# キーバインド（操作性向上）
# ==========================================

# ペインの分割を直感的に
bind | split-window -h -c "#{pane_current_path}" # 左右分割（現在のパスを引き継ぐ）
bind - split-window -v -c "#{pane_current_path}" # 上下分割（現在のパスを引き継ぐ）

# ==========================================
# 3. Emacsライクな操作設定
# ==========================================

# --- 画面分割 (Emacsの C-x 2 / C-x 3 に合わせる) ---
# Prefix + 3 で左右分割 (Emacsの C-x 3)
bind 3 split-window -h -c "#{pane_current_path}"
# Prefix + 2 で上下分割 (Emacsの C-x 2)
bind 2 split-window -v -c "#{pane_current_path}"

# --- ペイン移動 (C-p, C-n, C-b, C-f) ---
# 矢印キーではなく、Emacsのカーソル移動キーでペインを移動
bind -r C-p select-pane -U  # 上 (Previous line)
bind -r C-n select-pane -D  # 下 (Next line)
bind -r C-b select-pane -L  # 左 (Backward char)
bind -r C-f select-pane -R  # 右 (Forward char)

# --- ウィンドウ切り替え ---
# Prefix + o で次のペインへ（Emacsの C-x o 感覚）
bind o select-pane -t :.+

# --- ペインのリサイズ ---
# Shift を押しながら P, N, B, F でリサイズ
bind -r P resize-pane -U 5
bind -r N resize-pane -D 5
bind -r B resize-pane -L 5
bind -r F resize-pane -R 5


# ==========================================
# macOS固有設定（クリップボード連携）
# ==========================================

# コピーモードのキーバインドをEmacsに設定
setw -g mode-keys emacs

# macOSのクリップボード連携 (emacsモード用)
bind-key -T copy-mode-emacs C-w send-keys -X copy-pipe-and-cancel "pbcopy"
bind-key -T copy-mode-emacs M-w send-keys -X copy-pipe-and-cancel "pbcopy"
# マウスドラッグでコピー
bind-key -T copy-mode-emacs MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "pbcopy"

# ==========================================
# デザイン（ステータスバー）
# ==========================================

# ステータスバーをトップに配置する
set -g status-position top

# ステータスバーの色設定
set -g status-fg white
set -g status-bg black

# 左側の表示（セッション名）
set -g status-left-length 40
set -g status-left "#[fg=green]Session: #S #[default]"

# 右側の表示（日時）
set -g status-right "#[fg=cyan][%Y-%m-%d(%a) %H:%M]"

# アクティブなウィンドウを目立たせる
setw -g window-status-current-style fg=white,bg=blue,bright
